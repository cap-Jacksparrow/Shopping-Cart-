<h2 class="text-center my-6 border-b pb-2 text-2xl font-bold">ðŸ›’ Your Cart</h2>

<div class="grid  gap-6 sm:grid-cols-2 lg:grid-cols-3 px-4">
  {{#each products}}
  <div class="bg-white shadow-md rounded-lg overflow-hidden flex flex-col lg:max-w-72">
    <img src="{{this.product.image}}" alt="{{this.product.name}}" class="h-48 w-full object-fit">

    <div class="p-4 flex flex-col flex-grow">
      <h5 class="text-lg font-semibold">{{this.product.name}}</h5>
      <p class="text-sm text-gray-500 mb-2">{{this.product.des}}</p>
      <p class="font-bold mb-3">Price: â‚¹{{this.product.price}}</p>

      <div class="flex justify-between items-center mt-auto">
        <div class="flex items-center border rounded">
          <button 
            class="px-3 py-1 text-gray-600 hover:bg-gray-100" 
            onclick="changeqty('{{this._id}}','{{this.product._id}}','{{../user._id}}',-1)">âˆ’</button>
          <span id="{{this.product._id}}" class="px-3">{{this.qty}}</span>
          <button 
            class="px-3 py-1 text-gray-600 hover:bg-gray-100" 
            onclick="changeqty('{{this._id}}','{{this.product._id}}','{{../user._id}}',1)">+</button>
        </div>

        <button 
          class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm" 
          onclick="removePro('{{this._id}}','{{this.product._id}}')">Remove</button>
      </div>
    </div>
  </div>
  {{else}}
  <h3 class="col-span-full text-center text-xl text-red-500 mt-20">Cart is empty</h3>
  {{/each}}
</div>

{{#if products}}
<div class="flex justify-between items-center mt-8 px-4">
  <h4 class="text-xl font-semibold">
    Total: â‚¹<span id="totalvalue">{{total}}</span>
  </h4>
  <a href="/checkout" 
     class="bg-green-600 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-green-700 transition">
    Place Order
  </a>
</div>
{{/if}}

<script>
  function changeqty(cartId, proId, user, count) {
    let qty = parseInt(document.getElementById(proId).innerHTML);
    count = parseInt(count);

    $.ajax({
      url: '/change-product-quantity',
      data: { cart: cartId, product: proId, count, qty, user },
      method: 'post',
      success: function (response) {
        if (response.removeProduct) {
          alert('Product removed');
          location.reload();
        } else {
          document.getElementById(proId).innerHTML = qty + count;
          document.getElementById('totalvalue').innerHTML = response.total;
        }
      }
    });
  }

  function removePro(cartId, proId) {
    $.ajax({
      url: '/remove-product',
      data: { cartId, proId },
      method: 'post',
      success: function (response) {
        if (response) {
          alert("Product removed");
          location.reload();
        }
      },
      error: function (error) {
        console.log(error);
      }
    });
  }
</script>
